<!-- ... existing code ... -->
<div class="card mb-4">
    <div class="card-header">
        <h3>Uploaded Documents</h3>
    </div>
    <div class="card-body">
        <!-- Add action buttons for viewing and downloading application -->
        <div class="mb-4">
            <div class="d-flex gap-2">
                <a href="{{ url_for('agency.view_application_form', application_id=application.id) }}" 
                   class="btn btn-primary" target="_blank">
                    <i class="fas fa-eye"></i> View Application Form
                </a>
                <a href="{{ url_for('agency.download_application_form', application_id=application.id) }}" 
                   class="btn btn-success">
                    <i class="fas fa-download"></i> Download Application Form
                </a>
            </div>
        </div>
        
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Document Type</th>
                        <th>Uploaded At</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for document in application.documents %}
                    <tr>
                        <td>
                            {% if document.document_type == 'application_form' %}
                                <strong>Application Form</strong>
                            {% elif document.document_type == 'id_proof' %}
                                ID Proof
                            {% elif document.document_type == 'photo' %}
                                Photo
                            {% elif document.document_type == 'address_proof' %}
                                Address Proof
                            {% elif document.document_type == 'dob_proof' %}
                                Date of Birth Proof
                            {% elif document.document_type == 'signature' %}
                                Signature
                            {% else %}
                                {{ document.document_type }}
                            {% endif %}
                        </td>
                        <td>{{ document.uploaded_at.strftime('%d-%m-%Y %H:%M') }}</td>
                        <td>
                            <div class="btn-group">
                                <a href="{{ url_for('agency.view_document', document_id=document.id) }}" class="btn btn-sm btn-primary" target="_blank">
                                    <i class="fas fa-eye"></i> View
                                </a>
                                <button type="button" class="btn btn-sm btn-info" 
                                        onclick="showDocumentPreview('{{ url_for('agency.view_document', document_id=document.id) }}', '{{ document.document_type|title }}')">
                                    <i class="fas fa-search"></i> Preview
                                </button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Document Preview Modal -->
<div class="modal fade" id="documentPreviewModal" tabindex="-1" aria-labelledby="documentPreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="documentPreviewModalLabel">Document Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="embed-responsive embed-responsive-16by9">
                    <iframe id="documentPreviewFrame" class="embed-responsive-item" style="width: 100%; height: 500px;" allowfullscreen></iframe>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <a id="documentFullViewLink" href="#" target="_blank" class="btn btn-primary">Open in New Tab</a>
            </div>
        </div>
    </div>
</div>

{% block scripts %}
<script>
function showDocumentPreview(url, docType) {
    // Set the iframe source
    document.getElementById('documentPreviewFrame').src = url;
    
    // Update the modal title
    document.getElementById('documentPreviewModalLabel').textContent = docType + ' Preview';
    
    // Update the full view link
    document.getElementById('documentFullViewLink').href = url;
    
    // Show the modal
    var previewModal = new bootstrap.Modal(document.getElementById('documentPreviewModal'));
    previewModal.show();
}
</script>
{% endblock %}